{"version":3,"file":"master-tab.umd.js","sources":["../master-tab.js","../node_modules/@arnellebalane/event-emitter/dist/event-emitter.js"],"sourcesContent":["import EventEmitter from '@arnellebalane/event-emitter';\n\nconst MasterTab = new EventEmitter();\n\nconst STORAGE_KEY = MasterTab.STORAGE_KEY || 'mastertab';\nconst INSTANCE_ID = MasterTab.INSTANCE_ID\n    || Math.floor(Math.random() * 0x10000).toString(16);\n\nconst state = {\n    ACTIVE: 'a',\n    PASSIVE: 'p',\n    HIDDEN: 'h'\n};\n\nconst getState = () => {\n    if (document.visibilityState === 'hidden') return state.HIDDEN;\n    if (document.hasFocus()) return state.ACTIVE;\n    return state.PASSIVE;\n};\n\nconst findLastTabWithState = (tabStack, state) => {\n    for (let i = tabStack.length - 1; i >= 0; i--) {\n        const [instanceId, instanceState] = tabStack[i].split(':');\n        if (instanceState === state) {\n            return instanceId;\n        }\n    }\n    return null;\n};\n\nconst handleTabStackChange = tabStackString => {\n    const tabStack = tabStackString ? tabStackString.split(';') : [];\n    const tabStates = [state.ACTIVE, state.PASSIVE, state.HIDDEN];\n\n    for (const tabState of tabStates) {\n        const selectedTab = findLastTabWithState(tabStack, tabState);\n        if (selectedTab) {\n            return MasterTab.emit('change', selectedTab === INSTANCE_ID);\n        }\n    }\n};\n\n['pageshow', 'pagehide', 'focus', 'blur', 'visibilitychange'].forEach(event => {\n    window.addEventListener(event, () => {\n        const tabStackString = localStorage.getItem(STORAGE_KEY);\n        const tabStack = tabStackString ? tabStackString.split(';') : [];\n\n        let index = tabStack.findIndex(tab => tab.split(':')[0] === INSTANCE_ID);\n        if (index < 0) {\n            index = tabStack.length;\n        }\n\n        const currentState = getState();\n        tabStack[index] = [INSTANCE_ID, currentState].join(':');\n\n        if (currentState === state.ACTIVE) {\n            tabStack.push(tabStack[index]);\n            tabStack.splice(index, 1);\n        }\n\n        const updatedTabStackString = tabStack.join(';');\n        localStorage.setItem(STORAGE_KEY, updatedTabStackString);\n        handleTabStackChange(updatedTabStackString);\n    });\n});\n\nwindow.addEventListener('unload', () => {\n    const tabStackString = localStorage.getItem(STORAGE_KEY);\n    const tabStack = tabStackString ? tabStackString.split(';') : [];\n    const index = tabStack.findIndex(tab => tab.split(':')[0] === INSTANCE_ID);\n\n    if (index >= 0) {\n        tabStack.splice(index, 1);\n    }\n\n    const updatedTabStackString = tabStack.join(';');\n    localStorage.setItem(STORAGE_KEY, updatedTabStackString);\n});\n\nwindow.addEventListener('storage', e => {\n    if (e.key === STORAGE_KEY) {\n        handleTabStackChange(e.newValue);\n    }\n});\n\nexport default MasterTab;\n","var t=function(){this.$listeners={}};t.prototype.on=function(t,s){this.$listeners[t]||(this.$listeners[t]=[]),this.$listeners[t].push(s)},t.prototype.off=function(t,s){if(this.$listeners[t]){if(s instanceof Function){var e=this.$listeners[t].indexOf(s);this.$listeners[t].splice(e,1)}this.$listeners[t].length&&s||delete this.$listeners[t]}},t.prototype.emit=function(t,s){this.$listeners[t]&&this.$listeners[t].forEach(function(t){return t(s)})},module.exports=t;\n//# sourceMappingURL=event-emitter.js.map\n"],"names":["MasterTab","t","this","$listeners","prototype","on","s","push","off","Function","e","indexOf","splice","length","emit","forEach","module","STORAGE_KEY","INSTANCE_ID","Math","floor","random","toString","state","findLastTabWithState","tabStack","let","i","split","handleTabStackChange","tabStackString","const","selectedTab","event","window","addEventListener","localStorage","getItem","index","findIndex","tab","currentState","document","visibilityState","hasFocus","join","updatedTabStackString","setItem","key","newValue"],"mappings":"8KAEMA,EAAY,gBCFlB,IAAIC,EAAE,WAAWC,KAAKC,eAAeF,EAAEG,UAAUC,GAAG,SAASJ,EAAEK,GAAGJ,KAAKC,WAAWF,KAAKC,KAAKC,WAAWF,OAAOC,KAAKC,WAAWF,GAAGM,KAAKD,IAAIL,EAAEG,UAAUI,IAAI,SAASP,EAAEK,GAAG,GAAGJ,KAAKC,WAAWF,GAAG,CAAC,GAAGK,aAAaG,SAAS,CAAC,IAAIC,EAAER,KAAKC,WAAWF,GAAGU,QAAQL,GAAGJ,KAAKC,WAAWF,GAAGW,OAAOF,EAAE,GAAGR,KAAKC,WAAWF,GAAGY,QAAQP,UAAUJ,KAAKC,WAAWF,KAAKA,EAAEG,UAAUU,KAAK,SAASb,EAAEK,GAAGJ,KAAKC,WAAWF,IAAIC,KAAKC,WAAWF,GAAGc,QAAQ,SAASd,GAAG,OAAOA,EAAEK,MAAMU,UAAef,wCDIxcgB,EAAcjB,EAAUiB,aAAe,YACvCC,EAAclB,EAAUkB,aACvBC,KAAKC,MAAsB,MAAhBD,KAAKE,UAAoBC,SAAS,IAE9CC,EACM,IADNA,EAEO,IAFPA,EAGM,IASNC,WAAwBC,EAAUF,GACpC,IAAKG,IAAIC,EAAIF,EAASZ,OAAS,EAAGc,GAAK,EAAGA,IAAK,CAC3C,MAAoCF,EAASE,GAAGC,MAAM,KACtD,UAAsBL,EAClB,YAGR,OAAO,MAGLM,WAAuBC,GAIzB,IAHAC,IAAMN,EAAWK,EAAiBA,EAAeF,MAAM,eACpCL,EAAcA,EAAeA,mBAEd,CAA7BQ,IACKC,EAAcR,EAAqBC,QACzC,GAAIO,EACA,OAAOhC,EAAUc,KAAK,SAAUkB,IAAgBd,YAK3D,WAAY,WAAY,QAAS,OAAQ,oBAAoBH,iBAAQkB,GAClEC,OAAOC,iBAAiBF,aACpBF,IAAMD,EAAiBM,aAAaC,QAAQpB,GACtCQ,EAAWK,EAAiBA,EAAeF,MAAM,QAEnDU,EAAQb,EAASc,mBAAUC,UAAOA,EAAIZ,MAAM,KAAK,KAAOV,IACxDoB,EAAQ,IACRA,EAAQb,EAASZ,QAGrBkB,IAAMU,EArCuB,WAA7BC,SAASC,gBAAqCpB,EAC9CmB,SAASE,WAAmBrB,EACzBA,EAoCHE,EAASa,IAAUpB,EAAauB,GAAcI,KAAK,KAE/CJ,IAAiBlB,IACjBE,EAASlB,KAAKkB,EAASa,IACvBb,EAASb,OAAO0B,EAAO,IAG3BP,IAAMe,EAAwBrB,EAASoB,KAAK,KAC5CT,aAAaW,QAAQ9B,EAAa6B,GAClCjB,EAAqBiB,OAI7BZ,OAAOC,iBAAiB,oBACpBJ,IAAMD,EAAiBM,aAAaC,QAAQpB,GACtCQ,EAAWK,EAAiBA,EAAeF,MAAM,QACjDU,EAAQb,EAASc,mBAAUC,UAAOA,EAAIZ,MAAM,KAAK,KAAOV,IAE1DoB,GAAS,GACTb,EAASb,OAAO0B,EAAO,GAG3BP,IAAMe,EAAwBrB,EAASoB,KAAK,KAC5CT,aAAaW,QAAQ9B,EAAa6B,KAGtCZ,OAAOC,iBAAiB,mBAAWzB,GAC3BA,EAAEsC,MAAQ/B,GACVY,EAAqBnB,EAAEuC"}